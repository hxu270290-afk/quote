<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Iceberg 3D Online Quote</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: #f4f5f7;
      color: #333;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      background: #fff;
      padding: 24px 28px 32px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    h1 {
      margin-top: 0;
      font-size: 26px;
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 14px;
      color: #666;
      margin-bottom: 24px;
    }

    .steps {
      display: grid;
      grid-template-columns: 2fr 2fr 1.5fr;
      gap: 24px;
      align-items: flex-start;
    }

    .step-title {
      font-size: 20px;
      margin-bottom: 16px;
      font-weight: 600;
    }

    .card {
      background: #fafbfc;
      border: 1px solid #e1e4ea;
      border-radius: 6px;
      padding: 18px 18px 20px;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .field-group {
      margin-bottom: 14px;
    }

    input[type="file"] {
      display: block;
      width: 100%;
      padding: 8px 0;
      font-size: 13px;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #cfd4dd;
      outline: none;
      background: #fff;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: #2c8f6b;
      box-shadow: 0 0 0 1px #2c8f6b22;
    }

    .inline-fields {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .small-text {
      font-size: 12px;
      color: #888;
      margin-top: 2px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .summary-row strong {
      font-weight: 600;
    }

    .total-row {
      border-top: 1px solid #dde2ea;
      margin-top: 8px;
      padding-top: 10px;
      font-size: 18px;
      font-weight: 700;
    }

    .btn-primary {
      width: 100%;
      margin-top: 14px;
      padding: 10px 0;
      border-radius: 4px;
      border: none;
      background: #7bb37d;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    .btn-primary:disabled {
      background: #c3cfd5;
      cursor: not-allowed;
    }

    .btn-primary:not(:disabled):hover {
      background: #6aa06c;
    }

    .quote-note {
      font-size: 11px;
      color: #888;
      margin-top: 4px;
      text-align: center;
    }

    .warning {
      font-size: 12px;
      color: #b34b4b;
      margin-top: 4px;
    }

    @media (max-width: 900px) {
      .steps {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <h1>Iceberg 3D – Instant FDM Quote</h1>
  <p class="subtitle">
    Upload your file, enter the estimated weight from your slicer, and configure material / colour / layer height to get an instant quote.
  </p>

  <div class="steps">
    <!-- STEP 1: FILE & WEIGHT -->
    <div>
      <div class="step-title">1: Parts to Add</div>
      <div class="card">
        <div class="field-group">
          <label for="fileInput">Upload file (STL / 3MF / OBJ)</label>
          <input id="fileInput" type="file" accept=".stl,.3mf,.obj" />
          <div class="small-text">
            File is used for reference only here – pricing is based on the weight you enter below.
          </div>
        </div>

        <div class="field-group">
          <label for="weightInput">Estimated weight (g)</label>
          <input id="weightInput" type="number" min="1" step="1" placeholder="e.g. 50" />
          <div class="small-text">
            Use the total weight from your slicing software (per part, not including supports if you prefer).
          </div>
          <div id="weightWarning" class="warning" style="display:none;">
            Please enter a valid weight in grams to get a quote.
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 2: CONFIGURE -->
    <div>
      <div class="step-title">2: Configure &amp; Add Parts</div>
      <div class="card">
        <div class="field-group">
          <label for="technologySelect">Technology</label>
          <select id="technologySelect" disabled>
            <option>Fused Filament Fabrication (FFF)</option>
          </select>
          <div class="small-text">Current quotes are for FDM / FFF printing.</div>
        </div>

        <div class="field-group">
          <label for="materialSelect">Material</label>
          <select id="materialSelect">
            <option value="PLA">PLA (standard)</option>
            <option value="PETG">PETG</option>
            <option value="TPU">TPU (flexible)</option>
            <option value="PLA_CF">PLA-CF / PETG-CF</option>
            <option value="ASA_ABS">ASA / ABS</option>
            <option value="PC">PC</option>
            <option value="PA">PA / Nylon</option>
            <option value="PA_CF">PA-CF</option>
          </select>
        </div>

        <div class="field-group">
          <label for="colourSelect">Colour</label>
          <select id="colourSelect">
            <option value="basic">Black / White (no extra)</option>
            <option value="standard">Standard colour (red / blue / grey / green)</option>
            <option value="special">Metallic / silk / special texture</option>
            <option value="custom">Special order colour (needs confirmation)</option>
          </select>
          <div class="small-text">
            Special colours may require extra lead time. Final confirmation will be sent by email/WhatsApp.
          </div>
        </div>

        <div class="inline-fields">
          <div class="field-group">
            <label for="layerSelect">Layer height</label>
            <select id="layerSelect">
              <option value="0.28">0.28 mm – draft / fast</option>
              <option value="0.20" selected>0.20 mm – standard</option>
              <option value="0.12">0.12 mm – high detail</option>
              <option value="0.08">0.08 mm – ultra fine</option>
            </select>
          </div>
          <div class="field-group">
            <label for="quantityInput">Quantity</label>
            <input id="quantityInput" type="number" min="1" step="1" value="1" />
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 3: SUMMARY -->
    <div>
      <div class="step-title">3: Review &amp; Quote</div>
      <div class="card">
        <div class="summary-row">
          <span>Base (incl. first 50 g)</span>
          <span id="basePriceDisplay">£19.00</span>
        </div>
        <div class="summary-row">
          <span>Extra weight charge</span>
          <span id="extraWeightDisplay">£0.00</span>
        </div>
        <div class="summary-row">
          <span>Material &amp; layer factors</span>
          <span id="factorsDisplay">× 1.00</span>
        </div>
        <div class="summary-row">
          <span>Colour surcharge</span>
          <span id="colourFeeDisplay">£0.00</span>
        </div>
        <div class="summary-row">
          <span>Quantity</span>
          <span id="quantityDisplay">1</span>
        </div>

        <div class="summary-row total-row">
          <span>Total (incl. VAT if applicable)</span>
          <span id="totalDisplay">£19.00</span>
        </div>

        <button id="quoteButton" class="btn-primary">
          Get Quote
        </button>
        <div class="quote-note">
          This is an instant estimate based on your inputs. Final price may be adjusted after file review / printability check.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // ----- INTERNAL PRICING CONFIG (不会在界面上展示系数) -----
  const pricingConfig = {
    basePrice: 19.0,          // 起步价，含 50g PLA 0.2 mm
    baseWeight: 50,           // g
    extraPricePerGram: 0.20,  // 超出部分（PLA 0.2mm）每克单价
    materials: {
      PLA: 1.0,
      PETG: 1.25,
      TPU: 1.35,
      PLA_CF: 1.45,      // PLA-CF / PETG-CF
      ASA_ABS: 1.4,
      PC: 1.6,
      PA: 1.8,
      PA_CF: 2.0
    },
    layerHeights: {
      "0.28": 0.85,
      "0.20": 1.0,
      "0.12": 1.4,
      "0.08": 1.8
    },
    colourFees: {
      basic: 0,       // 黑白
      standard: 1.5,  // 标准色：1–2£，这里取中间值
      special: 3.0,   // 金属丝绸等：2–4£
      custom: 4.0     // 需订货特殊色，可按需要调整
    }
  };

  // ----- DOM ELEMENTS -----
  const weightInput     = document.getElementById('weightInput');
  const materialSelect  = document.getElementById('materialSelect');
  const colourSelect    = document.getElementById('colourSelect');
  const layerSelect     = document.getElementById('layerSelect');
  const quantityInput   = document.getElementById('quantityInput');
  const quoteButton     = document.getElementById('quoteButton');
  const weightWarning   = document.getElementById('weightWarning');

  const basePriceDisplay    = document.getElementById('basePriceDisplay');
  const extraWeightDisplay  = document.getElementById('extraWeightDisplay');
  const factorsDisplay      = document.getElementById('factorsDisplay');
  const colourFeeDisplay    = document.getElementById('colourFeeDisplay');
  const quantityDisplay     = document.getElementById('quantityDisplay');
  const totalDisplay        = document.getElementById('totalDisplay');

  function formatCurrency(value) {
    return '£' + value.toFixed(2);
  }

  function calculateQuote() {
    const weight = parseFloat(weightInput.value);
    const qtyRaw = parseInt(quantityInput.value, 10);

    const quantity = isNaN(qtyRaw) || qtyRaw < 1 ? 1 : qtyRaw;
    quantityInput.value = quantity;
    quantityDisplay.textContent = quantity;

    if (isNaN(weight) || weight <= 0) {
      weightWarning.style.display = 'block';
      quoteButton.disabled = true;
      // 只更新显示起步价 × 数量
      const totalFallback = pricingConfig.basePrice * quantity;
      basePriceDisplay.textContent = formatCurrency(pricingConfig.basePrice);
      extraWeightDisplay.textContent = formatCurrency(0);
      factorsDisplay.textContent = '× 1.00';
      colourFeeDisplay.textContent = formatCurrency(0);
      totalDisplay.textContent = formatCurrency(totalFallback);
      return;
    } else {
      weightWarning.style.display = 'none';
      quoteButton.disabled = false;
    }

    const extraWeight = Math.max(0, weight - pricingConfig.baseWeight);
    const extraWeightFee = extraWeight * pricingConfig.extraPricePerGram;

    const materialKey = materialSelect.value;
    const layerKey    = layerSelect.value;
    const colourKey   = colourSelect.value;

    const materialFactor = pricingConfig.materials[materialKey] || 1.0;
    const layerFactor    = pricingConfig.layerHeights[layerKey] || 1.0;
    const colourFee      = pricingConfig.colourFees[colourKey] || 0;

    const factorsCombined = materialFactor * layerFactor;

    const basePlusExtra = pricingConfig.basePrice + extraWeightFee;
    const pricePerPart = basePlusExtra * factorsCombined + colourFee;

    const total = pricePerPart * quantity;

    // 更新显示
    basePriceDisplay.textContent   = formatCurrency(pricingConfig.basePrice);
    extraWeightDisplay.textContent = formatCurrency(extraWeightFee);
    factorsDisplay.textContent     = '× ' + factorsCombined.toFixed(2);
    colourFeeDisplay.textContent   = formatCurrency(colourFee);
    totalDisplay.textContent       = formatCurrency(total);
  }

  // 点击按钮时也强制计算一次（方便在 Wix 里做“提交表单”前锁定价格）
  quoteButton.addEventListener('click', function (e) {
    e.preventDefault();
    calculateQuote();
    // 在这里你可以把 totalDisplay.innerText 写入一个隐藏字段，给 Wix 表单用
    // 例如：document.getElementById('hiddenQuoteTotal').value = totalDisplay.innerText;
  });

  // 实时更新
  [weightInput, materialSelect, colourSelect, layerSelect, quantityInput].forEach(function (el) {
    el.addEventListener('input', calculateQuote);
    el.addEventListener('change', calculateQuote);
  });

  // 初始计算
  calculateQuote();
</script>
</body>
</html>
